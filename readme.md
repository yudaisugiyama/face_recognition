# 顔認証
---

OpenCVが提供するニューラルネットワークを使った顔認証プログラムです。

# 概要
---
**画像から顔を探す**
　opencvの[学習済みモデル（ YuNet ）](https://github.com/opencv/opencv_zoo/blob/master/models/face_detection_yunet/face_detection_yunet_2022mar.onnx)を使って、入力画像に写っている全ての顔を検知します。

```
python3 generate_feature_dictionary.py image.jpg
```
```python
# 出力結果
detect face001.jpg
detect face002.jpg
```
**特徴量を抽出**
　opencvの[学習済みモデル（ SFace ）](https://github.com/opencv/opencv_zoo/blob/master/models/face_recognition_sface/face_recognition_sface_2021dec.onnx)を用いた主成分分析 Principal component analysis: PCA で検知した顔の特徴量をバイナリデータ（ .npy ）で記録します。PCAは、機械学習の領域において、教師なし学習の手法に分類されます。抽出した特徴量データは、顔認証時の比較に用いられます。
```
python3 generete_align_faces.py face001.jpg
```
```python
# 出力結果
[[ 1.0104824  -0.27215034 -0.71405953 -0.87517506  0.00389223 -0.1839284
   0.01142257 -0.44956702  0.03662679 -0.39796054  0.46007085 -0.06088337
  -0.01297498 -1.1298299   0.37303185  0.43969846 -0.34095144 -0.04964033
  -1.2272139  -2.1214345  -0.18549275  0.8922819   0.11960763  0.77223134
   0.5342472  -0.7730306  -1.4274194   1.8125564   0.6490261  -0.04502441
   0.5183337  -0.35876504  0.41267633 -0.09122817 -0.29209054 -1.0360929
  -2.0980008  -0.9665532  -0.6873243   0.62472284  0.6136779   0.43884304
   0.21370319 -0.42783555  1.0306702  -0.5922523  -0.94522977 -0.56085473
  -0.7349479   0.2995443  -0.6609485   0.967863   -0.23500206 -1.0027
   0.14959362  0.6948466   0.20996577 -0.41858143 -0.45549178 -1.3208458
   0.07673392 -0.675134   -0.59380424 -1.2847273   1.0797298   0.6626117
  -1.1375809  -0.5997244  -0.94118273  0.5142751   1.7478433   0.16758981
  -0.59906757 -0.4755656  -0.00704053 -1.0432098   0.6617984   0.35294676
  -0.6083387  -0.06501649  0.05919824 -1.1771747  -0.19511949 -0.97371036
   0.31679118 -1.4154489   0.5849364  -1.1418072   0.01273499 -1.3948367
  -0.29925135  0.48717988  0.27448478  0.72260255 -1.0111405   1.4687538
  -0.27050474 -0.35491237  0.32085615  0.6784525  -0.44945103  1.3379085
   0.26420072 -1.1753008  -0.17626134 -1.154213    1.3525176   0.17465107
   0.74826276  0.8192146   1.124522   -1.6056353  -0.45654687  0.10799104
   0.6146027  -0.22945762 -1.4774954   0.33510458  0.14113072  0.32448423
  -0.37261093 -0.88707745  0.31457287 -0.6544261   0.11450361 -1.790522
  -0.5010543   0.36887324]]
<class 'numpy.ndarray'>
extract  face001
```

**特徴量を比較・認証**
　入力画像に対して、先述した検知及び抽出を行い、入力画像内の顔と事前に持っている特徴量データをコサイン類似度で比較し、認証します。認証の閾値はOpenCV Tutorialsのデフォルト値0.363を採用しています。この手法で世界の著名人の顔画像のデータベース Labeled Faces in the Wild: LFW を用いた顔認証の正確性は99.60%です。

![](result.png)

# 参考文献
---
- https://qiita.com/UnaNancyOwen/items/8c65a976b0da2a558f06
 
